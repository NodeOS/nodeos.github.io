---
title: Global Modules as System Packages
layout: post
author: Jacob Groundwater
author_home: https://twitter.com/0x604
gravatar: 60f1d97dcc47c78778af94e6cf2f0099
---

Node modules come in two basic flavors.
**Local modules** are installed under `node_modules` as direct dependencies of your project.
**Global modules** are usually installed in `/usr/local`,
and are used to expose module executables on the command line.

Since we're using node and npm for the entire system,
we should relate the concept of global and local modules to packages from a package manager like apt, yum, or brew.

Most package managers provide the following types of packages:

1. a **library** is dynamically linked executable code required by *other* code
2. an **executable** is a binary, or runnable-script that creates a new process
3. a **service** is a process that is daemonized, and managed by init

We must be able to provide the same functionalities to build a fully feautred system.

### libraries

In the case of node-os, 
a **library** would be any module which you'd install with `npm install` and then load with `require(...)`.
In a system like Ubuntu, a library would probably be a shared lib like *openssl*, or *libxml2*.
Typically libraries are pre-compiled, meaning you only download the platform binary when installing.
This is often much quicker, and less error prone that downloading and compiling source files.

`npm` handles pure-js libraries quite well, and node-os will not be changing how that works.
To install a dependency to your module, call `npm install $dep` from within your modules directory.
The story for c++ dependencies is a bit different, but I'm going to save that story for another time.


### executables

**Executable** packages are just npm modules that expose executable node files.
Installing with `npm install -g` places those files onto your `PATH`, allowing you to call them from the command line.
The `package.json` allows you to specify executables quite easily.

```json
{
  "name": "bender-rodriguez",
  "bin": {
    "destroy-all-humans": "destroy-all-humans.js"
  }
}
```

While `npm install -g bender-rodriguez` would install this package,
and link it's executables, on node-os it's better to use `npkg install bender-rodriguez`.
On node-os, *global* modules are installed relative to the user, not the system.
This keeps isolation high in multi-user environment,
and let's non-root users run `npkg` commands without needing elevated privileges.

### services

Finally that brings us to **services**. Services are long-running daemons,
like web-servers, databases, ssh-servers, etc.
The `package.json` doesn't really have a *service* key, but it does have a `scripts:start` key.
Define a service in your `package.json` file as such:

```json
{
  "name": "planet-express-server",
  "scripts": {
    "start": "node server.js"
  }
}
```

You can start the package with `npm start`,
but that isn't really a solution for starting services managed by the system.
To install and run a service the *node-os way*

1. install the package with `npkg install $service`
2. start the package through *init* with `npkg start $service`

A job stanza will be generated by *npkg* and sent to *init*.
Your service will be long-running, and restarted if it exits abnormally.

Creating services in detail will be *yet another post*.
